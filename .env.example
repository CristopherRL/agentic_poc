# OpenAI credentials
OPEN_API_KEY=sk-your-openai-key

# Filesystem layout
PROJECT_ROOT=.
CSV_DIR=docs/public/data
SQLITE_PATH=data/db/app.db
SQL_SCHEMA_PATH=data/db/sql_schema.md
DOCS_DIR=docs/public/docs
MANUALS_DIR=docs/public/docs/manuals
VDB_DIR=data/vdb
FAISS_INDEX_NAME=faiss_index

# LLM models & temperatures
ROUTER_LLM_MODEL=gpt-4o-mini
ROUTER_LLM_TEMPERATURE=0.0
SQL_LLM_MODEL=gpt-4o-mini
SQL_LLM_TEMPERATURE=0.0
SPLIT_LLM_MODEL=gpt-4o
SPLIT_LLM_TEMPERATURE=0.0
SYNTHESIS_LLM_MODEL=gpt-4o
SYNTHESIS_LLM_TEMPERATURE=0.2

# Retrieval tuning
RAG_TOP_K=4

# Security settings
QUESTION_MAX_LENGTH=2000
DANGEROUS_SQL_KEYWORDS=["DROP","DELETE","UPDATE","INSERT","ALTER","CREATE","TRUNCATE","EXEC","EXECUTE","MERGE","REPLACE"]

# Routing heuristics
SQL_KEYWORDS=["sales","revenue","quantity","count","sum","average","table","query","sql","fact","dim","month","year","country","model","analytics","report"]
DOC_KEYWORDS=["manual","warranty","contract","policy","appendix","instructions","procedure"]
TABLE_COMMENTS={"DIM_COUNTRY":"Stores geography metadata: 'country' (full name), 'country_code' (ISO-2), and 'region' (e.g., Western Europe).","DIM_MODEL":"Catalog of vehicles: 'model_id' (unique), 'model_name', 'brand' (Toyota/Lexus), 'segment' (SUV), 'powertrain' (Petrol/HEV/PHEV).","DIM_ORDERTYPE":"Order classifications: 'ordertype_id' (unique), 'ordertype_name' (Private/Fleet/Demo), 'description' (B2C/B2B/Dealer demo).","FACT_SALES":"Core fact table of sales: 'model_id' -> DIM_MODEL, 'country_code' -> DIM_COUNTRY, plus 'year', 'month', 'contracts' (units sold).","FACT_SALES_ORDERTYPE":"Sales by order type: same keys as FACT_SALES plus 'ordertype_id' -> DIM_ORDERTYPE."}

# Prompt templates - Router Agent
ROUTE_SYSTEM_PROMPT="Decide whether the user's question requires structured SQL data, unstructured documents, both, or neither. Reply with exactly one word: 'SQL', 'RAG', 'BOTH', or 'NONE'. Use the provided heuristic hints as guidance."
INSUFFICIENT_CONTEXT_MESSAGE="I'm here to help with Toyota/Lexus analytics and documentation. Could you provide more detail so I can choose the right data sources?"

# Prompt templates - RAG Agent
RAG_SYSTEM_PROMPT="You are a Lexus/Toyota documentation expert. Answer using only the provided context. If the context is insufficient, say so. Cite sources in the format (Source: <path>, Page: <n>) whenever possible."

# Prompt templates - SQL Agent
SQL_GENERATION_SYSTEM_PROMPT="You are a data analyst writing SQL for a Toyota/Lexus sales warehouse. Always return a single valid SQL SELECT statement. Respect filters implied by the user's question (models, powertrains, countries, years, months, order types). Use only the provided schema and join keys. Do not add commentary or markdown fences."
SQL_GENERATION_USER_PROMPT="Database context:\n{schema}\n\nYou are an expert SQL generation assistant. Your ONLY job is to write a single, valid SQL query.\n\n--- RULES ---\n1. **Analyze the User Question:** Identify all explicit filters (brand, model, segment, powertrain, country, region, year, month).\n2. **Use Exact Values:** You MUST use the exact filter values from the question (e.g., `fs.year = 2024` for '2024').\n3. **NO INVENTED FILTERS:** NEVER add filters that are not in the question. **NEVER** use 'Sample rows' for filter values.\n4. **Handle Comparisons:** For questions like 'Compare Toyota vs Lexus', use an `IN` clause (e.g., `dm.brand IN ('Toyota', 'Lexus')`) and `GROUP BY` the comparison column (e.g., `GROUP BY dm.brand`).\n5. **Handle Regions:** For regional questions (e.g., 'Western Europe'), you MUST `JOIN DIM_COUNTRY dc ON fs.country_code = dc.country_code` and filter on `dc.region`.\n6. **Handle Monthly:** If the question asks for 'monthly' results, add `fs.month` to the `SELECT` and `GROUP BY` clauses, but do **not** add a month filter unless a specific month is mentioned.\n7. **Output SQL ONLY:** Your output MUST be ONLY the SQL query. No commentary, no markdown.\n\n--- EXAMPLES (FOR REFERENCE ONLY; DO NOT ANSWER THESE) ---\nQuestion: Monthly RAV4 HEV sales in Germany in 2024\nSQL: SELECT fs.year, fs.month, SUM(fs.contracts) AS total_contracts FROM FACT_SALES fs JOIN DIM_MODEL dm ON fs.model_id = dm.model_id JOIN DIM_COUNTRY dc ON fs.country_code = dc.country_code WHERE dm.brand = 'Toyota' AND dm.model_name = 'RAV4' AND dm.powertrain = 'HEV' AND dc.country = 'Germany' AND fs.year = 2024 GROUP BY fs.year, fs.month;\n\nQuestion: Compare Toyota vs Lexus SUV sales in Western Europe in 2024\nSQL: SELECT dm.brand, SUM(fs.contracts) AS total_contracts FROM FACT_SALES fs JOIN DIM_MODEL dm ON fs.model_id = dm.model_id JOIN DIM_COUNTRY dc ON fs.country_code = dc.country_code WHERE dm.segment = 'SUV' AND dc.region = 'Western Europe' AND fs.year = 2024 AND dm.brand IN ('Toyota', 'Lexus') GROUP BY dm.brand;\n\nQuestion: Total sales for B2B fleet orders in France in 2023\nSQL: SELECT SUM(fs.contracts) AS total_contracts FROM FACT_SALES_ORDERTYPE fs JOIN DIM_ORDERTYPE do ON fs.ordertype_id = do.ordertype_id JOIN DIM_COUNTRY dc ON fs.country_code = dc.country_code WHERE do.ordertype_name = 'Fleet' AND dc.country_code = 'FR' AND fs.year = 2023;\n--- END OF EXAMPLES ---\n\nNow apply the rules to the actual user request below.\nUSER QUESTION: {question}\nReturn only the SQL query that answers this question."
SQL_SYSTEM_PROMPT="You are a sales analytics assistant. Summarize the SQL results clearly and reference key figures. If the result is empty, explain why or state that more data is required."

# Prompt templates - Hybrid Agent
HYBRID_SPLIT_SYSTEM_PROMPT="You are a planning assistant. Split the incoming user question into two focused queries: one for SQL analytics against the sales warehouse and one for document-based RAG lookup. Return a JSON object with keys 'sql_question' and 'rag_question'. If a portion is unnecessary, return an empty string for that key. Keep the phrasing concise and suitable for direct execution by downstream tools."
HYBRID_SPLIT_USER_PROMPT="User question: {question}\nReturn JSON with keys 'sql_question' and 'rag_question'."
HYBRID_SYSTEM_PROMPT="You are an AI assistant that combines structured analytics with policy/manual insights. Blend both inputs, reconcile discrepancies, and cite document sources when applicable."